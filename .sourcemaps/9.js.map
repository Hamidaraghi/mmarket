{"version":3,"sources":["../../src/pages/passwordreset/passwordreset.module.ts","../../src/pages/passwordreset/passwordreset.ts"],"names":[],"mappings":"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","file":"9.js","sourcesContent":["import { PasswordresetPage } from './passwordreset';\r\nimport { NgModule } from '@angular/core';\r\nimport { IonicPageModule } from 'ionic-angular';\r\n\r\n@NgModule({\r\n  declarations: [PasswordresetPage],\r\n  imports: [IonicPageModule.forChild(PasswordresetPage)],\r\n})\r\nexport class PasswordresetPagePageModule { }\n\n\n// WEBPACK FOOTER //\n// ./src/pages/passwordreset/passwordreset.module.ts","import { ToastController } from 'ionic-angular/components/toast/toast-controller';\nimport { Http } from '@angular/http';\nimport { WooCommerceProvider } from './../../providers/woo-commerce/woo-commerce';\nimport { Component, NgZone } from '@angular/core';\nimport { NavController, NavParams, AlertController, IonicPage } from 'ionic-angular';\n\n@IonicPage({})\n@Component({\n  selector: 'page-passwordreset',\n  templateUrl: 'passwordreset.html',\n})\nexport class PasswordresetPage {\n  WooCommerce: any = {};\n  WooCommerce3: any = {};\n  userName: string = '';\n  phone: string = null;\n  maskedPhone: string = '';\n  user: any = {};\n  submitAttempt: boolean = false;\n  sendCodeSubmitAttempt: boolean = false;\n  secret: string = '';\n  secretMatch: string = ''\n  isLoading: boolean = false;\n  newPassword: string = null;\n  timer: number = 120;\n  timeOut: any ={}\n  interval: any = {};\n  constructor(public navCtrl: NavController, public navParams: NavParams, public WP: WooCommerceProvider, public http: Http,\n    private ngZone: NgZone, public toastCtrl: ToastController, public alertCtrl: AlertController) {\n\n    this.WooCommerce3 = WP.WooCommerce3;\n\n    this.WooCommerce = this.WP.init();    \n  }\n\n  ionViewDidLoad() {\n    console.log('ionViewDidLoad PasswordresetPage');\n  }\n\n  resetPasswordByUserName(userName: string) {\n    this.submitAttempt = true;\n    let userData = {\"field\":\"login\", \"value\":userName}\n    this.WooCommerce3.postAsync('sep/v1/get-user/',userData).then(data => {\n      console.log(data);\n      if (data.body == \"null\") {\n        alert(\"هیچ کاربری با این شناسه یافت نشد!\");\n        this.ngZone.run(() => {\n          this.submitAttempt = false;\n          this.isLoading = false;\n          \n        })\n        return;\n      }\n      this.isLoading = true;\n      this.submitAttempt = true;\n      this.timer = 120;\n\n      let ID = JSON.parse(data.body)\n      this.user.id = ID;\n      console.log(this.user);\n      this.passwordResetByPhone(userName);\n    })\n    \n  }\n\n  /* checkEmail(email) {\n    \n    let validEmail = false;\n    let reg = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n\n    if (!reg.test(email)) {\n      //email structure is ok     \n      validEmail = false;\n      console.log(validEmail);\n      this.toastCtrl.create({\n        message: \"ساختار ایمیل وارد شده معتبر نیست\",\n        showCloseButton: true,\n        closeButtonText: \"خب\",\n        cssClass: \"rtl\"\n      }).present();\n      return false\n    } else { return true; }\n\n  } */\n\n  passwordResetByPhone(phone: string) {\n\n  this.timer = 120;\n  this.ngZone.run(()=>{\n  this.sendCodeSubmitAttempt = true\n})\n  \n    this.secret = (Math.floor(Math.random() * 90000) + 10000).toString();\n    console.log(this.secret);\n    let smsData = {\"to\":phone, \"msg\": this.secret}\n    this.WooCommerce3.postAsync(\"sep/v1/send-sms\", smsData).then(res=> {\n        console.log(res);\n        if (res.statusCode == 200) {\n          this.toastCtrl.create({\n            message: \"پیامک حاوی کد تغییر رمز به شماره تلفن همراه شما ارسال شد.\"\n            , duration: 5000\n          }).present();\n\n\n          this.timeOut =  setTimeout(() => {\n            this.sendCodeSubmitAttempt = false;\n            alert(' بازیابی رمز بیش از محدوده زمانی به طول انجامید، لطفا بعدا دوباره تلاش کنید.')\n            this.secret = null;\n            this.isLoading = false;\n            this.submitAttempt = false;\n            \n            clearInterval(this.interval);\n\n          }, this.timer * 1000);\n\n          clearInterval(this.interval);     \n          this.interval = setInterval(() => {\n            if (this.timer >= 0)\n            this.ngZone.run(()=>{\n              this.timer--;\n            })\n            \n          }, 1000)\n\n\n        } else {\n          this.submitAttempt = false;\n          this.isLoading = false;\n\n          this.toastCtrl.create({\n            message: \"ارسال پیامک تایید با خطا مواجه شد لطفا بعدا دوباره تلاش فرمایید.\"\n            , duration: 5000\n          }).present();\n        }\n      }, error => {\n        console.log(error);\n        this.toastCtrl.create({\n          message: \"ارسال پیامک تایید با خطا مواجه شد لطفا بعدا دوباره تلاش فرمایید.\"\n          , duration: 5000\n        }).present();\n      });\n\n  }\n\n  verifySecret(secretMatch) {\n    if (secretMatch == this.secret) {\n      //alert(\"your secret is True\")\n      clearInterval(this.interval);\n      clearTimeout(this.timeOut);\n      return true;\n      //this.updateUser(this.user, this.newPassword);\n    } else {\n      alert(\"عدد وارد شده درست نمی باشد!\");\n\n      return false;\n    }\n  }\n\n  updateUserPassword(user, newPassword) {\n    console.log(user)\n    console.log(newPassword);\n    let strongRegex = new RegExp(\"^(?=.{6,})\");\n    if (!strongRegex.test(newPassword)) {\n      this.toastCtrl.create({\n        message: \"طول گذرواژه باید حداقل 6 کاراکتر باشد\",\n        cssClass: \"rtl\",\n        showCloseButton: true,\n        closeButtonText: \"خب\"\n      }).present();\n      return\n    } else {\n      //بروزرسانی کاربر با رمز جدید\n      var data = { \"password\": newPassword }\n      this.WooCommerce3.put('customers/' + user.id, data, (err, data, res) => {\n        console.log(res);\n        console.log(data)\n        if (data.statusCode == 200 && data.statusMessage == \"OK\") {\n          // successful password change\n         /*  clearInterval(this.interval);\n          clearTimeout(this.timeOut); */\n          this.alertCtrl.create({\n            title: \"تغییر گذرواژه\",\n            message: \"گذرواژه شما با موفقیت تغییر یافت. لطفا وارد حساب کاربری خود شوید\",\n            cssClass: \"rtl\",\n            buttons: [{\n              text: \"ورود\", handler: () => {\n                this.navCtrl.pop();\n              },\n            }]\n\n          }).present();\n\n         \n        } else {\n          clearInterval(this.interval);\n          clearTimeout(this.timeOut);\n          console.log(data);\n          alert('خطایی رخ داده است. لطفا بعدا دوباره تلاش کنید')\n        }\n      });\n    }\n\n  }\n\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/passwordreset/passwordreset.ts"],"sourceRoot":""}